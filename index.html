<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏á‡∏≤‡∏ô</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            background: white;
            padding: 2rem;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            text-align: center;
            max-width: 420px;
            width: 95%;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        h1 {
            color: #333;
            margin-bottom: 1.5rem;
            font-size: 1.8rem;
        }

        h2 {
            color: #555;
            margin-bottom: 1rem;
            font-size: 1.3rem;
        }

        /* Input group styling handled above */

        label {
            display: block;
            margin-bottom: 0.5rem;
            color: #555;
            font-weight: 500;
        }

        input[type="text"], input[type="password"], input[type="tel"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e1e1;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        .input-group {
            margin-bottom: 1.5rem;
            text-align: left;
            width: 100%;
        }

        input[type="text"]:focus, input[type="password"]:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.3s;
            margin: 0.5rem;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #6c757d;
        }

        .qr-code {
            background: white;
            padding: 20px;
            border: 2px solid #e1e1e1;
            border-radius: 10px;
            margin: 1rem 0;
            display: inline-block;
        }

        .booth-status {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 1rem 0;
        }

        .booth-item {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 8px;
            border-left: 4px solid #e74c3c;
            text-align: left;
        }

        .booth-item.visited {
            border-left-color: #27ae60;
            background: #d5f4e6;
        }

        .error {
            color: #e74c3c;
            margin: 1rem 0;
            padding: 10px;
            background: #fdf2f2;
            border-radius: 8px;
        }

        .success {
            color: #27ae60;
            margin: 1rem 0;
            padding: 10px;
            background: #f0f9f4;
            border-radius: 8px;
        }

        .user-id {
            font-family: monospace;
            font-size: 1.2rem;
            font-weight: bold;
            color: #333;
            margin: 1rem 0;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .nav-links {
            margin-top: 1rem;
        }

        .nav-links a {
            color: #667eea;
            text-decoration: none;
            margin: 0 10px;
            font-size: 14px;
        }

        .booth-links {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
            margin: 1rem 0;
        }

        .booth-link {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            text-decoration: none;
            color: #333;
            border: 2px solid #e1e1e1;
            transition: all 0.3s;
        }

        .booth-link:hover {
            border-color: #667eea;
            background: #f0f4ff;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å -->
        <div id="home" class="page active">
            <h1>üé´ ‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏á‡∏≤‡∏ô</h1>
            <p style="margin-bottom: 2rem; color: #666;">‡∏™‡πÅ‡∏Å‡∏ô QR Code ‡∏´‡∏ô‡πâ‡∏≤‡∏á‡∏≤‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</p>
            
            <button class="btn" onclick="goToRegister()">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</button>
            
            <div class="nav-links">
                <a href="#" onclick="showStaffMenu()">‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà</a>
            </div>
        </div>

        <!-- ‡∏´‡∏ô‡πâ‡∏≤‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô -->
        <div id="register" class="page">
            <h1>üìù ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏á‡∏≤‡∏ô</h1>
            
            <div class="input-group">
                <label for="userPhone">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå:</label>
                <input type="tel" id="userPhone" placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå 10 ‡∏´‡∏•‡∏±‡∏Å (‡πÄ‡∏ä‡πà‡∏ô 0812345678)" maxlength="10" style="width: 100%; font-size: 18px; padding: 14px;">
            </div>
            
            <button class="btn" onclick="checkRegistration()">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</button>
            <button class="btn btn-secondary" onclick="goHome()">‡∏Å‡∏•‡∏±‡∏ö</button>
            
            <div id="registerResult"></div>
        </div>

        <!-- ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏™‡∏î‡∏á QR Code ‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß -->
        <div id="userQR" class="page">
            <h1>üéüÔ∏è QR Code ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h1>
            
            <div id="userInfo"></div>
            <div id="qrCodeDisplay"></div>
            
            <h2>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ö‡∏π‡∏ò</h2>
            <div id="boothStatus" class="booth-status"></div>
            
            <button class="btn" onclick="refreshStatus()">‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</button>
            <button class="btn btn-secondary" onclick="goHome()">‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</button>
        </div>

        <!-- ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏°‡∏ô‡∏π‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà -->
        <div id="staffMenu" class="page">
            <h1>üë®‚Äçüíº ‡πÄ‡∏°‡∏ô‡∏π‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà</h1>
            
            <div class="booth-links">
                <a href="#" onclick="goToBoothStaff(1)" class="booth-link">
                    <strong>‡∏ö‡∏π‡∏ò‡∏ó‡∏µ‡πà 1</strong>
                </a>
                <a href="#" onclick="goToBoothStaff(2)" class="booth-link">
                    <strong>‡∏ö‡∏π‡∏ò‡∏ó‡∏µ‡πà 2</strong>
                </a>
                <a href="#" onclick="goToBoothStaff(3)" class="booth-link">
                    <strong>‡∏ö‡∏π‡∏ò‡∏ó‡∏µ‡πà 3</strong>
                </a>
                <a href="#" onclick="goToBoothStaff(4)" class="booth-link">
                    <strong>‡∏ö‡∏π‡∏ò‡∏ó‡∏µ‡πà 4</strong>
                </a>
                <a href="#" onclick="goToBoothStaff(5)" class="booth-link">
                    <strong>‡∏ö‡∏π‡∏ò‡∏ó‡∏µ‡πà 5</strong>
                </a>
            </div>
            
            <button class="btn btn-secondary" onclick="goHome()">‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</button>
        </div>

        <!-- ‡∏´‡∏ô‡πâ‡∏≤ Staff ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ö‡∏π‡∏ò -->
        <div id="boothStaff" class="page">
            <h1 id="boothTitle">üè™ ‡∏ö‡∏π‡∏ò‡∏ó‡∏µ‡πà 1</h1>
            
            <div class="input-group">
                <label for="scannedUserId">User ID ‡∏ó‡∏µ‡πà‡∏™‡πÅ‡∏Å‡∏ô‡πÑ‡∏î‡πâ:</label>
                <input type="text" id="scannedUserId" placeholder="‡∏Å‡∏£‡∏≠‡∏Å User ID ‡∏´‡∏£‡∏∑‡∏≠‡∏™‡πÅ‡∏Å‡∏ô QR">
            </div>
            
            <div class="input-group">
                <label for="staffPassword">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà:</label>
                <input type="password" id="staffPassword" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
            </div>
            
            <button class="btn" onclick="stampBooth()">Stamp ‡∏ö‡∏π‡∏ò</button>
            <button class="btn btn-secondary" onclick="showStaffMenu()">‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà</button>
            
            <div id="stampResult"></div>
        </div>

        <!-- ‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡πÅ‡∏Å‡∏ô QR Code -->
        <div id="qrStamp" class="page">
            <h1 id="qrStampTitle">üé´ Stamp ‡∏ö‡∏π‡∏ò</h1>
            
            <div id="userDetail"></div>
            
            <h2>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏π‡∏ò‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ Stamp:</h2>
            <div class="booth-links">
                <button class="booth-link" onclick="selectBoothForStamp(1)">
                    <strong>‡∏ö‡∏π‡∏ò‡∏ó‡∏µ‡πà 1</strong>
                </button>
                <button class="booth-link" onclick="selectBoothForStamp(2)">
                    <strong>‡∏ö‡∏π‡∏ò‡∏ó‡∏µ‡πà 2</strong>
                </button>
                <button class="booth-link" onclick="selectBoothForStamp(3)">
                    <strong>‡∏ö‡∏π‡∏ò‡∏ó‡∏µ‡πà 3</strong>
                </button>
                <button class="booth-link" onclick="selectBoothForStamp(4)">
                    <strong>‡∏ö‡∏π‡∏ò‡∏ó‡∏µ‡πà 4</strong>
                </button>
                <button class="booth-link" onclick="selectBoothForStamp(5)">
                    <strong>‡∏ö‡∏π‡∏ò‡∏ó‡∏µ‡πà 5</strong>
                </button>
            </div>
            
            <div style="margin-top: 2rem; display: flex; gap: 10px; justify-content: center;">
                <button class="btn btn-secondary" onclick="goHome()">‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</button>
                <button class="btn btn-secondary" onclick="showStaffMenu()">‡πÄ‡∏°‡∏ô‡∏π‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà</button>
            </div>
        </div>

        <!-- ‡∏´‡∏ô‡πâ‡∏≤ Confirm Stamp -->
        <div id="confirmStamp" class="page">
            <h1 id="confirmTitle">üéØ Confirm Stamp</h1>
            
            <div id="confirmDetail"></div>
            
            <div class="input-group">
                <label for="confirmPassword">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà:</label>
                <input type="password" id="confirmPassword" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
            </div>
            
            <button class="btn" onclick="confirmStampBooth()">‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô Stamp</button>
            <button class="btn btn-secondary" onclick="goBackToQRStamp()">‡∏Å‡∏•‡∏±‡∏ö</button>
            
            <div id="confirmResult"></div>
        </div>
    </div>


    <script>
        // Google Apps Script API URL
        const API_URL = 'https://script.google.com/macros/s/AKfycbw9WYOjpoM228W42d-TuY4cCLkyAn8VO9zOkNjHgGhJX2OkpfhILyX9U9uLCr9PdnjjBQ/exec';

        // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Demo ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö fallback (‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏ó‡∏µ‡πà‡∏ï‡∏±‡∏î 0 ‡πÅ‡∏•‡πâ‡∏ß)
        const demoPhones = [
            '812345678', // 0812345678
            '923456789', // 0923456789
            '634567890', // 0634567890
            '745678901'  // 0745678901
        ];
        
        const demoUsers = [
            { phone: '812345678', name: '‡∏™‡∏∏‡∏ò‡∏¥‡∏î‡∏≤ ‡∏°‡∏µ‡πÉ‡∏à' },
            { phone: '923456789', name: '‡∏≠‡∏ô‡∏±‡∏ô‡∏ï‡πå ‡∏£‡∏±‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ' },
            { phone: '634567890', name: '‡∏ô‡∏¥‡∏£‡∏°‡∏• ‡∏™‡∏∏‡∏Ç‡πÉ‡∏à' },
            { phone: '745678901', name: '‡∏û‡∏¥‡∏°‡∏û‡πå‡πÉ‡∏™ ‡πÉ‡∏™‡πÉ‡∏à' }
        ];

        const boothNames = [
            '‡∏ö‡∏π‡∏ò 1',
            '‡∏ö‡∏π‡∏ò 2', 
            '‡∏ö‡∏π‡∏ò 3',
            '‡∏ö‡∏π‡∏ò 4',
            '‡∏ö‡∏π‡∏ò 5'
        ];

        const staffPassword = 'MADT4';
        let currentBoothId = 1;
        let currentStampUserId = null;
        let selectedBoothForStamp = null;

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡∏ô‡πâ‡∏≤
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(pageId).classList.add('active');
        }

        function goHome() {
            showPage('home');
        }

        function goToRegister() {
            showPage('register');
            document.getElementById('userPhone').value = '';
            document.getElementById('registerResult').innerHTML = '';
        }

        function showStaffMenu() {
            showPage('staffMenu');
        }

        function goToBoothStaff(boothId) {
            currentBoothId = boothId;
            document.getElementById('boothTitle').textContent = `üè™ ‡∏ö‡∏π‡∏ò‡∏ó‡∏µ‡πà ${boothId} - ${boothNames[boothId-1]}`;
            document.getElementById('scannedUserId').value = '';
            document.getElementById('staffPassword').value = '';
            document.getElementById('stampResult').innerHTML = '';
            showPage('boothStaff');
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£
        function normalizePhone(phone) {
            // ‡∏•‡∏ö‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏Å‡∏Ç‡∏£‡∏∞‡∏û‡∏¥‡πÄ‡∏®‡∏©
            phone = phone.replace(/\D/g, '');
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£ 10 ‡∏´‡∏•‡∏±‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
            if (phone.length !== 10) {
                return null;
            }
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏Ç‡∏∂‡πâ‡∏ô‡∏ï‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢ 0 ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
            if (phone.charAt(0) !== '0') {
                return null;
            }
            
            // ‡∏ï‡∏±‡∏î‡πÄ‡∏•‡∏Ç 0 ‡∏î‡πâ‡∏≤‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏≠‡∏≠‡∏Å
            return phone.substring(1);
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô
        async function checkRegistration() {
            const userPhone = document.getElementById('userPhone').value.trim();
            
            if (!userPhone) {
                document.getElementById('registerResult').innerHTML = 
                    '<div class="error">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</div>';
                return;
            }

            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£
            const normalizedPhone = normalizePhone(userPhone);
            if (!normalizedPhone) {
                document.getElementById('registerResult').innerHTML = 
                    '<div class="error">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (10 ‡∏´‡∏•‡∏±‡∏Å ‡πÄ‡∏ä‡πà‡∏ô 0646877333)</div>';
                return;
            }

            console.log('Original phone:', userPhone, 'Normalized:', normalizedPhone);

            // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö
            document.getElementById('registerResult').innerHTML = 
                '<div style="color: #3498db;">üîç ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>';

            try {
                // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ Google Sheets API ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÉ‡∏ô‡∏ä‡∏µ‡∏ï "‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏á‡∏≤‡∏ô"
                const formData = new FormData();
                formData.append('action', 'checkParticipant');
                formData.append('phone', normalizedPhone);  // ‡πÉ‡∏ä‡πâ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏ó‡∏µ‡πà‡∏ï‡∏±‡∏î 0 ‡πÅ‡∏•‡πâ‡∏ß
                
                const response = await fetch(API_URL, {
                    method: 'POST',
                    body: formData
                });
                const data = await response.json();
                
                console.log('API Response for checkParticipant:', data);
                
                if (data.success && data.exists) {
                    // ‡∏û‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Google Sheets
                    const userData = {
                        userId: data.participant.userId || data.participant.user_id,
                        name: data.participant.name,
                        booths: [false, false, false, false, false], // ‡∏à‡∏∞‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡∏à‡∏≤‡∏Å API
                        registeredAt: new Date().toISOString()
                    };
                    
                    console.log('Found participant:', userData);
                    
                    // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô localStorage ‡∏Å‡πà‡∏≠‡∏ô
                    localStorage.setItem('currentUser', JSON.stringify(userData));
                    
                    document.getElementById('registerResult').innerHTML = 
                        '<div class="success">‚úÖ ‡∏û‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏•‡πâ‡∏ß! ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ö‡∏π‡∏ò...</div>';
                    
                    // ‡∏î‡∏∂‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ö‡∏π‡∏ò‡∏à‡∏≤‡∏Å Google Sheets ‡∏Å‡πà‡∏≠‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡πâ‡∏≤ QR
                    const boothSuccess = await getBoothStatus(userData.userId);
                    
                    // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏≤‡∏Å localStorage
                    const updatedUserData = JSON.parse(localStorage.getItem('currentUser') || '{}');
                    
                    document.getElementById('registerResult').innerHTML = 
                        '<div class="success">‚úÖ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á QR Code...</div>';
                    
                    setTimeout(() => {
                        showUserQR(updatedUserData);
                    }, 500);
                } else {
                    console.log('Participant not found:', data);
                    document.getElementById('registerResult').innerHTML = 
                        '<div class="error">' +
                        '<div style="font-size: 18px; margin-bottom: 15px;">‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</div>' +
                        '<div style="margin-bottom: 10px;">üìù ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</div>' +
                        '<div style="margin-bottom: 15px;">‡∏´‡∏£‡∏∑‡∏≠</div>' +
                        '<div style="background: #fff3cd; padding: 15px; border-radius: 8px; border: 2px solid #ffc107; margin: 10px 0;">' +
                        '<div style="color: #856404; font-weight: bold; margin-bottom: 10px;">üìã ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô?</div>' +
                        '<div style="margin-bottom: 10px;">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏á‡∏≤‡∏ô</div>' +
                        '<a href="https://forms.gle/2y12ALpP52XnCQ8W6" target="_blank" ' +
                        'style="display: inline-block; background: #007bff; color: white; padding: 10px 20px; ' +
                        'text-decoration: none; border-radius: 5px; font-weight: bold; margin-top: 10px;">' +
                        'üîó ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</a>' +
                        '</div>' +
                        '</div>';
                }
            } catch (error) {
                console.error('API Error:', error);
                
                // Fallback ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• demo ‡∏ñ‡πâ‡∏≤ API ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ
                setTimeout(() => {
                    checkRegistrationFallback(userPhone, normalizedPhone);
                }, 1000);
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô fallback ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• demo
        function checkRegistrationFallback(userPhone, normalizedPhone) {
            const demoUser = demoUsers.find(user => user.phone === normalizedPhone);
            
            if (demoUser) {
                const userId = 'DEMO' + normalizedPhone;
                
                const userData = {
                    userId: userId,
                    name: demoUser.name,
                    phone: normalizedPhone,
                    booths: [false, false, false, false, false],
                    registeredAt: new Date().toISOString()
                };
                
                localStorage.setItem('currentUser', JSON.stringify(userData));
                
                document.getElementById('registerResult').innerHTML = 
                    '<div class="success">‚úÖ ‡∏û‡∏ö‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Demo! ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á QR Code...</div>';
                
                setTimeout(() => {
                    showUserQR(userData);
                }, 1000);
            } else {
                document.getElementById('registerResult').innerHTML = 
                    '<div class="error">' +
                    '<div style="font-size: 18px; margin-bottom: 15px;">‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</div>' +
                    '<div style="margin-bottom: 10px;">üìù ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</div>' +
                    '<div style="margin-bottom: 15px;">‡∏´‡∏£‡∏∑‡∏≠</div>' +
                    '<div style="background: #fff3cd; padding: 15px; border-radius: 8px; border: 2px solid #ffc107; margin: 10px 0;">' +
                    '<div style="color: #856404; font-weight: bold; margin-bottom: 10px;">üìã ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô?</div>' +
                    '<div style="margin-bottom: 10px;">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏á‡∏≤‡∏ô</div>' +
                    '<a href="https://forms.gle/2y12ALpP52XnCQ8W6" target="_blank" ' +
                    'style="display: inline-block; background: #007bff; color: white; padding: 10px 20px; ' +
                    'text-decoration: none; border-radius: 5px; font-weight: bold; margin-top: 10px;">' +
                    'üîó ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</a>' +
                    '</div>' +
                    '</div>';
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á QR Code
        function showUserQR(userData) {
            showPage('userQR');
            
            document.getElementById('userInfo').innerHTML = 
                `<h2>‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ ${userData.name}</h2>
                 <div class="user-id">User ID: ${userData.userId}</div>`;
            
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á QR Code ‡∏ó‡∏µ‡πà‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ stamp
            const currentURL = window.location.origin + window.location.pathname;
            const stampURL = `${currentURL}?action=stamp&userId=${userData.userId}`;
            
            // ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏´‡∏±‡∏™ URL ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö QR Code
            const encodedURL = encodeURIComponent(stampURL);
            const qrCodeURL = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodedURL}`;
            
            // ‡πÅ‡∏™‡∏î‡∏á QR Code
            document.getElementById('qrCodeDisplay').innerHTML = 
                `<div class="qr-code">
                    <img src="${qrCodeURL}" alt="QR Code" style="width: 200px; height: 200px; border: 2px solid #e1e1e1; border-radius: 10px;" />
                    <p style="margin-top: 10px; font-size: 12px; color: #666;">
                        <strong>QR Code ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Stamp ‡∏ö‡∏π‡∏ò</strong><br>
                        ‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏´‡πâ‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏™‡πÅ‡∏Å‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏ö‡∏π‡∏ò<br>
                        <small style="color: #999;">URL: ${stampURL}</small>
                    </p>
                </div>`;
            
            updateBoothStatus(userData);
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ö‡∏π‡∏ò
        function updateBoothStatus(userData) {
            let statusHTML = '';
            let completedBooths = 0;
            
            for (let i = 0; i < 5; i++) {
                const visited = userData.booths[i];
                if (visited) completedBooths++;
                
                statusHTML += `
                    <div class="booth-item ${visited ? 'visited' : ''}">
                        <strong>‡∏ö‡∏π‡∏ò‡∏ó‡∏µ‡πà ${i + 1}</strong><br>
                        <span style="color: ${visited ? '#27ae60' : '#e74c3c'}">
                            ${visited ? '‚úÖ ‡πÄ‡∏Ç‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß' : '‚è≥ ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤'}
                        </span>
                    </div>
                `;
            }
            
            // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡πÅ‡∏ï‡∏°‡∏õ‡πå‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏ö‡∏π‡∏ò
            if (completedBooths === 5) {
                statusHTML += `
                    <div style="grid-column: span 2; margin-top: 15px; background: #d4edda; border-radius: 10px; padding: 15px; text-align: center;">
                        <strong style="color: #28a745; font-size: 18px;">üéâ ‡∏™‡πÅ‡∏ï‡∏°‡∏õ‡πå‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏ö‡∏π‡∏ò‡πÅ‡∏•‡πâ‡∏ß!</strong>
                        <p style="margin-top: 8px; color: #28a745;">‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏•‡∏∏‡πâ‡∏ô‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏• Lucky Draw</p>
                    </div>
                `;
            }
            
            document.getElementById('boothStatus').innerHTML = statusHTML;
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏î‡∏∂‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ö‡∏π‡∏ò‡∏à‡∏≤‡∏Å Google Sheets
        async function getBoothStatus(userId) {
            try {
                console.log('Getting booth status for user:', userId);
                // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Sheet "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ö‡∏π‡∏ò"
                const formData = new FormData();
                formData.append('action', 'getBoothStatus');
                formData.append('userId', userId);
                
                const response = await fetch(API_URL, {
                    method: 'POST',
                    body: formData
                });
                const data = await response.json();
                
                console.log('API Response for getBoothStatus:', data);
                
                if (data.success) {
                    // ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
                    let userData = JSON.parse(localStorage.getItem('currentUser') || '{}');
                    
                    if (userData.userId === userId) {
                        // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ö‡∏π‡∏ò
                        userData.booths = [false, false, false, false, false];
                        
                        // ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏π‡∏ò‡∏à‡∏≤‡∏Å API
                        if (data.booths && data.booths.length > 0) {
                            data.booths.forEach(booth => {
                                const boothId = parseInt(booth.boothId || booth.booth_id);
                                if (boothId >= 1 && boothId <= 5) {
                                    userData.booths[boothId - 1] = true;
                                    console.log(`Updated booth ${boothId} status to true`);
                                }
                            });
                        }
                        
                        // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï localStorage
                        localStorage.setItem('currentUser', JSON.stringify(userData));
                        
                        // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡∏´‡∏ô‡πâ‡∏≤ UI
                        updateBoothStatus(userData);
                        
                        console.log('Updated user data:', userData);
                    }
                    
                    return true;
                } else {
                    console.log('Failed to get booth status:', data.message || 'Unknown error');
                }
                return false;
            } catch (error) {
                console.error('Error getting booth status:', error);
                return false;
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
        async function refreshStatus() {
            const userData = JSON.parse(localStorage.getItem('currentUser'));
            if (userData) {
                document.getElementById('boothStatus').innerHTML = 
                    '<div style="color: #3498db; text-align: center;">üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞...</div>';
                
                // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ API ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
                const success = await getBoothStatus(userData.userId);
                if (!success) {
                    // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô localStorage
                    updateBoothStatus(userData);
                }
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô Stamp ‡∏ö‡∏π‡∏ò
        async function stampBooth() {
            const scannedUserId = document.getElementById('scannedUserId').value.trim();
            const password = document.getElementById('staffPassword').value.trim();
            
            if (!scannedUserId || !password) {
                document.getElementById('stampResult').innerHTML = 
                    '<div class="error">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô</div>';
                return;
            }
            
            if (password !== staffPassword) {
                document.getElementById('stampResult').innerHTML = 
                    '<div class="error">‚ùå ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</div>';
                return;
            }
            
            // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
            document.getElementById('stampResult').innerHTML = 
                '<div style="color: #3498db;">üîç ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ...</div>';
            
            // ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
            let userData = findUserData(scannedUserId);
            
            // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠‡πÉ‡∏ô localStorage ‡πÉ‡∏´‡πâ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏à‡∏≤‡∏Å Google Sheet
            if (!userData) {
                userData = await findUserDataFromAPI(scannedUserId);
                
                // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏à‡∏≠‡∏à‡∏≤‡∏Å API ‡πÉ‡∏´‡πâ‡∏î‡∏∂‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ö‡∏π‡∏ò‡∏î‡πâ‡∏ß‡∏¢
                if (userData) {
                    await getBoothStatus(userData.userId);
                    // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï userData ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏î‡∏∂‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ö‡∏π‡∏ò
                    const updatedUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
                    if (updatedUser.userId === userData.userId) {
                        userData = updatedUser;
                    }
                }
            }
            
            if (!userData) {
                document.getElementById('stampResult').innerHTML = 
                    '<div class="error">' +
                    '<div style="font-size: 16px; margin-bottom: 10px;">‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö User ID ‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</div>' +
                    '<div style="margin-bottom: 10px;">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏£‡∏∑‡∏≠ User ID</div>' +
                    '<div style="background: #fff3cd; padding: 10px; border-radius: 8px; border: 2px solid #ffc107; margin: 10px 0;">' +
                    '<div style="color: #856404; font-weight: bold; margin-bottom: 8px;">üìã ‡∏´‡∏≤‡∏Å‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</div>' +
                    '<a href="https://forms.gle/2y12ALpP52XnCQ8W6" target="_blank" ' +
                    'style="display: inline-block; background: #007bff; color: white; padding: 8px 15px; ' +
                    'text-decoration: none; border-radius: 5px; font-weight: bold;">' +
                    'üîó ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</a>' +
                    '</div>' +
                    '</div>';
                return;
            }
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ stamp ‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á
            if (userData.booths[currentBoothId - 1]) {
                document.getElementById('stampResult').innerHTML = 
                    '<div class="error">‚ö†Ô∏è User ‡∏Ñ‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ö‡∏π‡∏ò‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß</div>';
                return;
            }
            
            // Stamp ‡∏ö‡∏π‡∏ò
            userData.booths[currentBoothId - 1] = true;
            localStorage.setItem('currentUser', JSON.stringify(userData));
            
            document.getElementById('stampResult').innerHTML = 
                `<div class="success">‚úÖ Stamp ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!<br>
                 ${userData.name} ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ö‡∏π‡∏ò‡∏ó‡∏µ‡πà ${currentBoothId} ‡πÅ‡∏•‡πâ‡∏ß</div>`;
            
            // ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ü‡∏≠‡∏£‡πå‡∏°
            document.getElementById('scannedUserId').value = '';
            document.getElementById('staffPassword').value = '';
        }

        async function confirmStampBooth() {
            const password = document.getElementById('confirmPassword').value.trim();
            
            if (password !== staffPassword) {
                document.getElementById('confirmResult').innerHTML = 
                    '<div class="error">‚ùå ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</div>';
                return;
            }
            
            // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
            document.getElementById('confirmResult').innerHTML = 
                '<div style="color: #3498db;">‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>';
            
            try {
                console.log('Attempting to register stamp:', {
                    userId: currentStampUserId,
                    boothId: selectedBoothForStamp
                });
                
                // ‡∏™‡∏£‡πâ‡∏≤‡∏á FormData ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ö‡∏ö POST
                const formData = new FormData();
                formData.append('action', 'registerStamp');
                formData.append('userId', currentStampUserId);
                formData.append('boothId', selectedBoothForStamp);
                formData.append('staffId', 'staff');
                
                // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ Google Sheets API
                const response = await fetch(API_URL, {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                console.log('API Response for registerStamp:', data);
                
                if (data.success) {
                    // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÉ‡∏ô‡πÄ‡∏ß‡πá‡∏ö
                    const userData = findUserData(currentStampUserId);
                    if (userData) {
                        userData.booths[selectedBoothForStamp - 1] = true;
                        
                        // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô current user)
                        const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
                        if (currentUser.userId === userData.userId) {
                            localStorage.setItem('currentUser', JSON.stringify(userData));
                            // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï UI ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
                            updateBoothStatus(userData);
                        }
                        
                        document.getElementById('confirmResult').innerHTML = 
                            `<div class="success">
                                ‚úÖ Stamp ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!<br>
                                ${userData.name} ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ö‡∏π‡∏ò‡∏ó‡∏µ‡πà ${selectedBoothForStamp} ‡πÅ‡∏•‡πâ‡∏ß<br>
                                <small>‡πÄ‡∏ß‡∏•‡∏≤: ${new Date().toLocaleString('th-TH')}</small><br>
                                <small style="color: #666;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏•‡∏±‡∏ö‡∏™‡∏π‡πà‡πÄ‡∏°‡∏ô‡∏π‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà...</small>
                            </div>`;
                        
                        console.log('Stamp registered successfully');
                        
                        setTimeout(() => {
                            showStaffMenu();
                        }, 2000);
                    }
                } else {
                    console.error('Failed to register stamp:', data.message || 'Unknown error');
                    document.getElementById('confirmResult').innerHTML = 
                        `<div class="error">‚ùå ${data.message || '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£ stamp'}</div>`;
                }
            } catch (error) {
                console.error('Google Sheets API Error:', error);
                
                // Fallback ‡πÉ‡∏ä‡πâ localStorage
                document.getElementById('confirmResult').innerHTML = 
                    '<div style="color: #f39c12;">‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ<br>‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏£‡∏≠‡∏á...</div>';
                
                setTimeout(() => {
                    confirmStampBoothFallback();
                }, 1000);
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô fallback ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö stamp ‡∏ö‡∏π‡∏ò
        function confirmStampBoothFallback() {
            const userData = findUserData(currentStampUserId);
            
            if (userData.booths[selectedBoothForStamp - 1]) {
                document.getElementById('confirmResult').innerHTML = 
                    '<div class="error">‚ö†Ô∏è ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ö‡∏π‡∏ò‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß</div>';
                return;
            }
            
            // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
            userData.booths[selectedBoothForStamp - 1] = true;
            
            // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô current user)
            const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
            if (currentUser.userId === userData.userId) {
                localStorage.setItem('currentUser', JSON.stringify(userData));
            }
            
            document.getElementById('confirmResult').innerHTML = 
                `<div class="success">
                    ‚úÖ Stamp ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! (‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á)<br>
                    ${userData.name} ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ö‡∏π‡∏ò‡∏ó‡∏µ‡πà ${selectedBoothForStamp} ‡πÅ‡∏•‡πâ‡∏ß<br>
                    <small>‡πÄ‡∏ß‡∏•‡∏≤: ${new Date().toLocaleString('th-TH')}</small><br>
                    <small style="color: #666;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏•‡∏±‡∏ö‡∏™‡∏π‡πà‡πÄ‡∏°‡∏ô‡∏π‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà...</small>
                </div>`;
            
            setTimeout(() => {
                showStaffMenu();
            }, 2000);
        }

        function goBackToQRStamp() {
            showQRStampPage(currentStampUserId);
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏à‡∏≤‡∏Å Google Sheet
        async function findUserDataFromAPI(userId) {
            try {
                console.log('Searching user in Google Sheet:', userId);
                
                // ‡∏•‡∏≠‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏î‡πâ‡∏ß‡∏¢ userId ‡∏Å‡πà‡∏≠‡∏ô
                let formData = new FormData();
                formData.append('action', 'getUserByUserId');
                formData.append('userId', userId);
                
                let response = await fetch(API_URL, {
                    method: 'POST',
                    body: formData
                });
                let data = await response.json();
                
                console.log('API Response for getUserByUserId:', data);
                
                if (data.success && data.user) {
                    console.log('Found user by userId in Google Sheet:', data.user);
                    return {
                        userId: data.user.userId || data.user.user_id,
                        name: data.user.name,
                        phone: data.user.phone,
                        booths: [false, false, false, false, false], // ‡∏à‡∏∞‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡∏à‡∏≤‡∏Å getBoothStatus
                        registeredAt: new Date().toISOString()
                    };
                }
                
                // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠ ‡∏•‡∏≠‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£ (‡πÉ‡∏ô‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà userId ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£)
                console.log('Trying to search by phone number:', userId);
                formData = new FormData();
                formData.append('action', 'getUserByPhone');
                formData.append('phone', userId);
                
                response = await fetch(API_URL, {
                    method: 'POST',
                    body: formData
                });
                data = await response.json();
                
                console.log('API Response for getUserByPhone:', data);
                
                if (data.success && data.user) {
                    console.log('Found user by phone in Google Sheet:', data.user);
                    return {
                        userId: data.user.userId || data.user.user_id,
                        name: data.user.name,
                        phone: data.user.phone,
                        booths: [false, false, false, false, false], // ‡∏à‡∏∞‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡∏à‡∏≤‡∏Å getBoothStatus
                        registeredAt: new Date().toISOString()
                    };
                }
                
                console.log('User not found in Google Sheet, response:', data);
                return null;
            } catch (error) {
                console.error('Error searching user in Google Sheet:', error);
                return null;
            }
        }

        function findUserData(userId) {
            console.log('Looking for user:', userId); // debug
            
            // ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å localStorage ‡∏´‡∏£‡∏∑‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• demo
            const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
            console.log('Current user in localStorage:', currentUser); // debug
            
            if (currentUser.userId === userId) {
                console.log('Found user in localStorage'); // debug
                return currentUser;
            }
            
            // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠‡πÉ‡∏ô localStorage ‡πÉ‡∏´‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• demo
            if (userId === 'TEST123456') {
                console.log('Creating demo user for TEST123456'); // debug
                return {
                    userId: userId,
                    name: '‡∏ú‡∏π‡πâ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö',
                    phone: '123456789',
                    booths: [false, false, false, false, false],
                    registeredAt: new Date().toISOString()
                };
            }
            
            // ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏à‡∏≤‡∏Å demo users
            for (let i = 0; i < demoUsers.length; i++) {
                const demoUser = demoUsers[i];
                if (userId === ('DEMO' + demoUser.phone) || userId === demoUser.phone) {
                    console.log('Found demo user:', demoUser); // debug
                    return {
                        userId: 'DEMO' + demoUser.phone,
                        name: demoUser.name,
                        phone: demoUser.phone,
                        booths: [false, false, false, false, false],
                        registeredAt: new Date().toISOString()
                    };
                }
            }
            
            console.log('User not found in local data'); // debug
            return null;
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤ QR Stamp
        async function showQRStampPage(userId) {
            console.log('showQRStampPage called with userId:', userId); // debug
            currentStampUserId = userId;
            
            // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
            document.getElementById('userDetail').innerHTML = 
                '<div style="color: #3498db; text-align: center;">üîç ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ...</div>';
            showPage('qrStamp');
            
            // ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏à‡∏≤‡∏Å localStorage ‡∏Å‡πà‡∏≠‡∏ô
            let userData = findUserData(userId);
            console.log('Found userData in local:', userData); // debug
            
            // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠‡πÉ‡∏ô localStorage ‡πÉ‡∏´‡πâ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏à‡∏≤‡∏Å Google Sheet
            if (!userData) {
                console.log('User not found locally, searching in Google Sheet...'); // debug
                userData = await findUserDataFromAPI(userId);
                console.log('Found userData from API:', userData); // debug
                
                // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏à‡∏≠‡∏à‡∏≤‡∏Å API ‡πÉ‡∏´‡πâ‡∏î‡∏∂‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ö‡∏π‡∏ò‡∏î‡πâ‡∏ß‡∏¢
                if (userData) {
                    await getBoothStatus(userData.userId);
                    // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï userData ‡∏à‡∏≤‡∏Å localStorage ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏î‡∏∂‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ö‡∏π‡∏ò
                    const updatedUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
                    if (updatedUser.userId === userData.userId) {
                        userData = updatedUser;
                    }
                }
            }
            
            if (userData) {
                document.getElementById('userDetail').innerHTML = 
                    `<div style="background: #f0f9f4; padding: 15px; border-radius: 10px; margin: 1rem 0;">
                        <h3>üë§ ${userData.name}</h3>
                        <p><strong>User ID:</strong> ${userData.userId}</p>
                        <p style="color: #27ae60;">‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡πÅ‡∏•‡πâ‡∏ß</p>
                    </div>`;
                console.log('Showing qrStamp page with user data'); // debug
            } else {
                console.log('User not found anywhere, showing error'); // debug
                document.getElementById('userDetail').innerHTML = 
                    `<div style="background: #fdf2f2; padding: 15px; border-radius: 10px; margin: 1rem 0; color: #e74c3c;">
                        <h3>‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</h3>
                        <p><strong>User ID:</strong> ${userId}</p>
                        <p>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏£‡∏∑‡∏≠ User ID</p>
                        <div style="background: #fff3cd; padding: 15px; border-radius: 8px; border: 2px solid #ffc107; margin: 15px 0;">
                            <div style="color: #856404; font-weight: bold; margin-bottom: 10px;">üìã ‡∏´‡∏≤‡∏Å‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</div>
                            <a href="https://forms.gle/2y12ALpP52XnCQ8W6" target="_blank" 
                               style="display: inline-block; background: #007bff; color: white; padding: 10px 20px; 
                               text-decoration: none; border-radius: 5px; font-weight: bold; margin-bottom: 10px;">
                               üîó ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</a>
                        </div>
                        <button class="btn btn-secondary" onclick="goHome()" style="margin-top: 10px;">‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</button>
                    </div>`;
            }
        }

        async function selectBoothForStamp(boothId) {
            selectedBoothForStamp = boothId;
            
            // ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
            let userData = findUserData(currentStampUserId);
            
            // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠‡πÉ‡∏ô localStorage ‡πÉ‡∏´‡πâ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏à‡∏≤‡∏Å Google Sheet
            if (!userData) {
                userData = await findUserDataFromAPI(currentStampUserId);
            }
            
            if (!userData) {
                alert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á');
                return;
            }
            
            document.getElementById('confirmTitle').textContent = 
                `üéØ Confirm Stamp ‡∏ö‡∏π‡∏ò‡∏ó‡∏µ‡πà ${boothId}`;
            
            document.getElementById('confirmDetail').innerHTML = 
                `<div style="background: #fff3cd; padding: 15px; border-radius: 10px; margin: 1rem 0;">
                    <h3>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£ Stamp</h3>
                    <p><strong>‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°:</strong> ${userData.name}</p>
                    <p><strong>User ID:</strong> ${userData.userId}</p>
                    <p><strong>‡∏ö‡∏π‡∏ò‡∏ó‡∏µ‡πà:</strong> ${boothId} - ${boothNames[boothId-1]}</p>
                    <p style="color: #856404;"><strong>‚ö†Ô∏è ‡πÇ‡∏õ‡∏£‡∏î‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà</strong></p>
                </div>`;
            
            document.getElementById('confirmPassword').value = '';
            document.getElementById('confirmResult').innerHTML = '';
            showPage('confirmStamp');
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö URL parameters
        function checkURLParameters() {
            const urlParams = new URLSearchParams(window.location.search);
            const action = urlParams.get('action');
            const userId = urlParams.get('userId');
            
            console.log('URL Parameters:', { action, userId }); // debug
            
            if (action === 'stamp' && userId) {
                // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ parameter ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö stamp ‡πÉ‡∏´‡πâ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ QR stamp
                console.log('Redirecting to stamp page for user:', userId); // debug
                setTimeout(() => {
                    showQRStampPage(userId);
                }, 100);
                return true;
            }
            
            return false;
        }

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö
        document.addEventListener('DOMContentLoaded', function() {
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö URL parameters ‡∏Å‡πà‡∏≠‡∏ô
            if (!checkURLParameters()) {
                // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ parameter ‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å‡∏õ‡∏Å‡∏ï‡∏¥
                const currentUser = localStorage.getItem('currentUser');
                if (currentUser) {
                    console.log('‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ:', JSON.parse(currentUser));
                }
            }
        });
    </script>
</body>
</html>